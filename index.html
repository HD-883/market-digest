<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weekly Market Signals Digest</title>
  <meta name="description" content="Plain-English weekly signals, watchlist, and options playbook. Auto-updated.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="wrap header">
    <h1>📊 Weekly Market Signals Digest</h1>
    <p class="sub">Simple, to the point. Auto-updates every 6 hours.</p>
    <p class="date">Last updated: <span id="lastUpdated">—</span></p>

    <div class="actions">
      <button id="refreshBtn" class="btn">🔄 Refresh</button>
      <button id="alertsBtn" class="btn alt">⚡ Show Only Alerts</button>
      <button id="copyBtn" class="btn">📋 Copy Summary</button>
      <button id="shareBtn" class="btn">📣 Share</button>
    </div>
  </header>

  <main class="wrap" id="contentRoot">
    <section id="headline" class="card hero">
      <h2 id="headlineText">Market view loading…</h2>
      <p class="muted small">Sources: Yahoo Finance (prices), FRED DFII10 (real yields). Educational, not financial advice.</p>
    </section>

    <section id="watchlist" class="card highlight">
      <h2>💹 This Week’s Watchlist (plain English)</h2>
      <ul id="watchlistList" class="bullets"></ul>
      <p class="muted small">Screen: price above 20 & 50‑day averages and positive 1‑week change. Source: Yahoo Finance.</p>
    </section>

    <section id="options" class="card">
      <h2>🧰 Options Playbook (educational)</h2>
      <ul id="optionsList" class="bullets"></ul>
      <p class="note small">Defined‑risk ideas only (debit spreads, calendars, condors). Always size small; options can lose 100% of premium.</p>
    </section>

    <section id="verdicts" class="card">
      <h2>🎯 Verdicts (tendency)</h2>
      <div id="verdictGrid" class="grid"></div>
    </section>

    <section id="macro" class="card">
      <h2>🏛️ Macro & Policy</h2>
      <ul id="macroList" class="bullets"></ul>
    </section>

    <section id="equities" class="card">
      <h2>📈 Equities</h2>
      <ul id="equitiesList" class="bullets"></ul>
    </section>

    <section id="crypto" class="card">
      <h2>🪙 Crypto</h2>
      <ul id="cryptoList" class="bullets"></ul>
    </section>

    <section id="metals" class="card">
      <h2>🥇 Gold & 🥈 Silver</h2>
      <ul id="metalsList" class="bullets"></ul>
    </section>

    <section id="events" class="card">
      <h2>🗓️ Next 7–10 Days</h2>
      <ul id="eventsList" class="bullets"></ul>
    </section>

    <section id="alerts" class="card alert">
      <h2>🚨 Alerts</h2>
      <ul id="alertsList" class="bullets"></ul>
      <p class="hint">Triggers: Real yield ±25 bps w/w, DXY ±1.5% w/w, BTC ±10% w/w, ETH ±12% w/w, GSR &lt;75/&gt;90, Gold/Silver ±5% w/w.</p>
    </section>

    <section id="summary" class="card">
      <h2>🧠 Bottom Line (plain English)</h2>
      <ul id="summaryList" class="bullets"></ul>
      <div class="note">Educational only. You make your own decisions.</div>
    </section>
  </main>

  <footer class="wrap foot">
    <p>Mobile-first • Bookmark this page</p>
  </footer>

  <script>
  let alertsOnly = false;

  async function fetchData() {
    const resp = await fetch('data.json?cache=' + Date.now());
    return await resp.json();
  }

  function verdictEmoji(trend) {
    const t = (trend || '').toLowerCase();
    if (t === 'up') return '⬆️';
    if (t === 'down') return '⬇️';
    return '➡️';
  }

  function plainHeadline(vs) {
    const ups = vs.filter(v => (v.trend||'').toLowerCase()==='up').length;
    const downs = vs.filter(v => (v.trend||'').toLowerCase()==='down').length;
    if (ups >= 3) return 'Markets lean bullish this week; dips may get bought.';
    if (downs >= 3) return 'Caution: more signals point down; keep risk tight.';
    return 'Mixed signals: pick spots; watch alerts and dollar moves.';
  }

  function buildSummary(d) {
    const out = [];
    const vmap = {};
    (d.verdicts || []).forEach(v => { vmap[v.asset] = (v.trend || 'Sideways').toLowerCase(); });

    if (vmap['Gold'] === 'up') out.push('Gold: could drift higher if real yields stay soft.');
    if (vmap['Silver'] === 'up') out.push('Silver: may outperform gold if the dollar eases.');
    if (vmap['BTC'] === 'up') out.push('Bitcoin: momentum okay; position size carefully.');
    if (vmap['ETH'] === 'up') out.push('Ethereum: follows BTC; watch L2/ETF headlines.');
    if (vmap['Stocks'] === 'up') out.push('Stocks: bias up; tech leaders may carry.');
    if (vmap['Stocks'] === 'down') out.push('Stocks: be selective or defensive until breadth improves.');
    if (!out.length) out.push('Base case: Sideways — wait for clearer signals.');
    return out;
  }

  function render(d) {
    document.getElementById('lastUpdated').textContent = d.last_updated || '—';
    document.getElementById('headlineText').textContent = plainHeadline(d.verdicts || []);

    // Watchlist
    const wl = d.watchlist || [];
    document.getElementById('watchlistList').innerHTML = wl.length
      ? wl.map(w => `<li><strong>${w.ticker}</strong> — ${w.reason} <span class="muted small">(Source: Yahoo Finance)</span></li>`).join('')
      : '<li class="muted">No clear setups this run.</li>';

    // Options Playbook
    const op = d.options_playbook || [];
    document.getElementById('optionsList').innerHTML = op.length
      ? op.map(x => `<li><strong>${x.ticker}</strong> — ${x.strategy}: ${x.text} <span class="muted small">(Heuristic)</span></li>`).join('')
      : '<li class="muted">No options ideas this run.</li>';

    // Verdicts
    const vgrid = document.getElementById('verdictGrid');
    vgrid.innerHTML = (d.verdicts || []).map(item => `
      <div class="tile">
        <div class="label">${item.asset}</div>
        <div class="trend ${item.trend.toLowerCase()}">${verdictEmoji(item.trend)} ${item.trend}</div>
        <div class="notes">${item.note || ''}</div>
      </div>
    `).join('');

    // Bullets
    const fill = (id, arr) => {
      const el = document.getElementById(id);
      el.innerHTML = (arr || []).map(x => `<li>${x}</li>`).join('');
    };
    fill('macroList', d.macro);
    fill('equitiesList', d.equities);
    fill('cryptoList', d.crypto);
    fill('metalsList', d.metals);
    fill('eventsList', d.events);
    fill('alertsList', d.alerts);

    // Summary
    const sList = buildSummary(d);
    document.getElementById('summaryList').innerHTML = sList.map(x => `<li>${x}</li>`).join('');

    applyAlertsFilter();
  }

  function applyAlertsFilter() {
    const ids = ['headline','watchlist','options','verdicts','macro','equities','crypto','metals','events'];
    ids.forEach(id => {
      const el = document.getElementById(id);
      el.style.display = alertsOnly ? (id==='alerts' || id==='summary' ? '' : 'none') : '';
    });
    document.getElementById('alerts').style.display = '';
    document.getElementById('summary').style.display = '';
    document.getElementById('alertsBtn').textContent = alertsOnly ? '📋 Show All Sections' : '⚡ Show Only Alerts';
  }

  async function init() {
    try { render(await fetchData()); }
    catch (e) {
      console.error(e);
      document.getElementById('verdictGrid').innerHTML = '<p class="muted">Unable to load data.json.</p>';
    }

    document.getElementById('refreshBtn').addEventListener('click', () => location.reload());
    document.getElementById('alertsBtn').addEventListener('click', () => { alertsOnly = !alertsOnly; applyAlertsFilter(); });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      const text = document.querySelector('#summary').innerText.trim();
      try { await navigator.clipboard.writeText(text); alert('Summary copied.'); } catch(_) { alert('Copy failed.'); }
    });

    document.getElementById('shareBtn').addEventListener('click', async () => {
      const text = document.querySelector('#summary').innerText.trim();
      if (navigator.share) {
        try { await navigator.share({ title: 'Weekly Market Summary', text }); } catch(_) {}
      } else {
        try { await navigator.clipboard.writeText(text); alert('Shared text copied to clipboard.'); } catch(_) { alert('Copy failed.'); }
      }
    });
  }
  init();
  </script>
</body>
</html>
